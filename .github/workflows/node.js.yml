name: Test

on:
  push:
    branches: [ 'main' ]
  pull_request:
    branches: [ 'main' ]

permissions:
  contents: read
  pull-requests: read

jobs:
  setup:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: latest
        cache: 'npm'
  install:
    needs: setup
    runs-on: macos-latest
    steps:
    - run: brew install pango jpeg librsvg
    - run: npm install --build-from-source canvas
    - run: npm ci
  build:
    needs: install
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - run: npm run docs
    - run: npm run lint
    - run: npm run ll
  commit:
    needs: build
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - run: git config --global user.name 'LL-10'
    - run: git config --global user.email 'LL-10@users.noreply.github.com'
    - run: git diff --quiet && git diff --staged --quiet || git commit -am 'Automatic commit'
    - run: git push

